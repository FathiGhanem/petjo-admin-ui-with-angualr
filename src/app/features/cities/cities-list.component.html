<p-toast />
<p-confirmDialog />

<div class="page-container">
  <div class="page-header">
    <div>
      <h1>Cities</h1>
      <p class="subtitle">Manage available cities and locations</p>
    </div>
    <div class="page-actions">
      <p-button label="Add City" icon="pi pi-plus" severity="primary"
                (onClick)="openCreateDialog()" />
    </div>
  </div>

  <p-card>
    <p-table
      [value]="cities()"
      [loading]="loading()"
      [globalFilterFields]="['name']"
      #dt
      styleClass="p-datatable-sm"
    >
      <ng-template pTemplate="caption">
        <div class="table-header">
          <span class="p-input-icon-left">
            <i class="pi pi-search"></i>
            <input pInputText type="text" placeholder="Search cities..."
                   (input)="dt.filterGlobal($any($event.target).value, 'contains')" />
          </span>
          <span class="record-count">{{ cities().length }} cities</span>
        </div>
      </ng-template>

      <ng-template pTemplate="header">
        <tr>
          <th style="width: 80px">ID</th>
          <th pSortableColumn="name">Name <p-sortIcon field="name" /></th>
          <th style="width: 120px">Actions</th>
        </tr>
      </ng-template>

      <ng-template pTemplate="body" let-city>
        <tr>
          <td>{{ city.id }}</td>
          <td>
            <div class="city-name">
              <i class="pi pi-map-marker" style="color: #f59e0b"></i>
              <span>{{ city.name }}</span>
            </div>
          </td>
          <td>
            <div class="action-buttons">
              <button pButton icon="pi pi-pencil" severity="info"
                      [text]="true" [rounded]="true" size="small"
                      pTooltip="Edit" tooltipPosition="top"
                      (click)="openEditDialog(city)"></button>
              <button pButton icon="pi pi-trash" severity="danger"
                      [text]="true" [rounded]="true" size="small"
                      pTooltip="Delete" tooltipPosition="top"
                      (click)="confirmDelete(city)"></button>
            </div>
          </td>
        </tr>
      </ng-template>

      <ng-template pTemplate="emptymessage">
        <tr>
          <td colspan="3">
            <div class="empty-state">
              <i class="pi pi-map-marker"></i>
              <h3>No cities</h3>
              <p>Create your first city</p>
            </div>
          </td>
        </tr>
      </ng-template>
    </p-table>
  </p-card>
</div>

<!-- Create/Edit Dialog -->
<p-dialog [header]="editingCity() ? 'Edit City' : 'New City'"
          [(visible)]="dialogVisible" [modal]="true" [style]="{ width: '400px' }">
  <div class="form-field">
    <label>City Name *</label>
    <input pInputText [(ngModel)]="formName" placeholder="Enter city name" class="w-full"
           (keyup.enter)="save()" />
  </div>
  <ng-template pTemplate="footer">
    <p-button label="Cancel" severity="secondary" [text]="true"
              (onClick)="dialogVisible = false" />
    <p-button [label]="editingCity() ? 'Update' : 'Create'" icon="pi pi-check"
              severity="primary" [disabled]="!formName.trim()"
              (onClick)="save()" />
  </ng-template>
</p-dialog>
